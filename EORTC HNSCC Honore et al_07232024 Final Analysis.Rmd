---
title: "EORTC HNSCC Honore et al_07232024 Final Analysis"
output: html_notebook
---
library(swimplot)
library(grid)
library(gtable)
library(readr) 
library(mosaic)
library(dplyr) 
library(survival) 
library(survminer) 
library(ggplot2)
library(scales)
library(coxphf)
library(ggthemes)
library(tidyverse)
library(gtsummary)
library(flextable)
library(parameters)
library(car)
library(ComplexHeatmap)
library(tidyverse)
library(readxl)
library(janitor)
library(DT)
library(rms)

#ctDNA Detection Rates by Window and Stages
```{r}
#ctDNA at Baseline
rm(list=ls())
setwd("~/Downloads")
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.Base!="",]
circ_data$ctDNA.Base <- factor(circ_data$ctDNA.Base, levels=c("NEGATIVE","POSITIVE"))
circ_data <- subset(circ_data, ctDNA.Base %in% c("NEGATIVE", "POSITIVE"))
circ_data$Stage <- factor(circ_data$Stage, levels=c("III","IVA","IVB"))
positive_counts_by_stage <- aggregate(circ_data$ctDNA.Base == "POSITIVE", by=list(circ_data$Stage), FUN=sum)
total_counts_by_stage <- aggregate(circ_data$ctDNA.Base, by=list(circ_data$Stage), FUN=length)
combined_data <- data.frame(
  Stage = total_counts_by_stage$Group.1,
  Total_Count = total_counts_by_stage$x,
  Positive_Count = positive_counts_by_stage$x,
  Rate = (positive_counts_by_stage$x / total_counts_by_stage$x) * 100  # Convert to percentage
)
combined_data$Rate <- sprintf("%.2f%%", combined_data$Rate)
overall_total_count <- nrow(circ_data)
overall_positive_count <- nrow(circ_data[circ_data$ctDNA.Base == "POSITIVE",])
overall_positivity_rate <- (overall_positive_count / overall_total_count) * 100  # Convert to percentage
overall_row <- data.frame(
  Stage = "Overall",
  Total_Count = overall_total_count,
  Positive_Count = overall_positive_count,
  Rate = sprintf("%.2f%%", overall_positivity_rate)
)
combined_data <- rbind(combined_data, overall_row)
print(combined_data)

#ctDNA post-treatment
rm(list=ls())
setwd("~/Downloads")
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"))
circ_data$Stage <- factor(circ_data$Stage, levels=c("III","IVA","IVB"))
positive_counts_by_stage <- aggregate(circ_data$ctDNA.postTx == "POSITIVE", by=list(circ_data$Stage), FUN=sum)
total_counts_by_stage <- aggregate(circ_data$ctDNA.postTx, by=list(circ_data$Stage), FUN=length)
combined_data <- data.frame(
  Stage = total_counts_by_stage$Group.1,
  Total_Count = total_counts_by_stage$x,
  Positive_Count = positive_counts_by_stage$x,
  Rate = (positive_counts_by_stage$x / total_counts_by_stage$x) * 100  # Convert to percentage
)
combined_data$Rate <- sprintf("%.2f%%", combined_data$Rate)
overall_total_count <- nrow(circ_data)
overall_positive_count <- nrow(circ_data[circ_data$ctDNA.postTx == "POSITIVE",])
overall_positivity_rate <- (overall_positive_count / overall_total_count) * 100  # Convert to percentage
overall_row <- data.frame(
  Stage = "Overall",
  Total_Count = overall_total_count,
  Positive_Count = overall_positive_count,
  Rate = sprintf("%.2f%%", overall_positivity_rate)
)
combined_data <- rbind(combined_data, overall_row)
print(combined_data)
```



#Summary Table
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]

circ_data_subset <- circ_data %>%
  select(
    Gender,
    Age,
    Smoking.Assumption,
    Alcohol.Assumption,
    Prim.Location,
    ECOG,
    Stage,
    Stage.TNM,
    p16,
    NAC,
    Treatment.Type,
    RFS.Event,
    OS.Event,
    FU.Biopsy.months) %>%
  mutate(
    Gender = factor(Gender),
    Age = as.numeric(Age),
    Smoking.Assumption = factor(Smoking.Assumption),
    Alcohol.Assumption = factor(Alcohol.Assumption),
    Prim.Location = factor(Prim.Location),
    ECOG = factor(ECOG),
    Stage = factor(Stage),
    Stage.TNM = factor(Stage.TNM),
    p16 = factor(p16),
    NAC = factor(NAC, levels = c("FALSE", "TRUE"), labels = c("No treatment", "Neoadjuvant Treatment")),
    Treatment.Type = factor(Treatment.Type),
    RFS.Event = factor(RFS.Event, levels = c("FALSE", "TRUE"), labels = c("No Recurrence", "Recurrence")),
    OS.Event = factor(OS.Event, levels = c("FALSE", "TRUE"), labels = c("Alive", "Deceased")),
    FU.Biopsy.months = as.numeric(FU.Biopsy.months)) 
table1 <- circ_data_subset %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{median} ({min} - {max})",
      all_categorical() ~ "{n} ({p}%)")) %>%
  bold_labels()
table1
fit1 <- as_flex_table(
  table1,
  include = everything(),
  return_calls = FALSE,
  strip_md_bold = TRUE)
fit1
save_as_docx(fit1, path= "~/Downloads/table1.docx")
```



#Heatmap for the clinical factors
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data %>% arrange(Stage)
circ_datadf <- as.data.frame(circ_data)

ha <- HeatmapAnnotation(
  Stage = circ_data$Stage,
  Gender = circ_data$Gender,
  Prim.Location = circ_data$Prim.Location,
  p16 = circ_data$p16,
  NAC = circ_data$NAC,
  ctDNA.Base = circ_data$ctDNA.Base,
  ctDNA.postTx = circ_data$ctDNA.postTx,
  RFS.Event = circ_data$RFS.Event,
  OS.Event = circ_data$OS.Event,
  
    col = list(Stage = c("III" = "seagreen1", "IVA" = "khaki", "IVB" = "orange"),
    Gender = c("Female" = "goldenrod" , "Male" = "blue4"),
    Prim.Location = c("Hypopharynx" = "purple", "Oropharynx" ="lightblue", "Larynx" = "brown2", "Oral cavity" = "lightgrey"),
    p16 = c("Negative" = "yellow", "Positive" ="brown"),
    NAC = c("TRUE" = "darkmagenta", "FALSE" = "grey"),
    ctDNA.Base = c("POSITIVE" = "red3", "NEGATIVE" ="blue"),
    ctDNA.postTx = c("POSITIVE" = "red3", "NEGATIVE" ="blue"),
    RFS.Event = c("TRUE" = "red3", "FALSE" ="blue"),
    OS.Event = c("TRUE" = "black", "FALSE" ="grey")
)
)
ht <- Heatmap(matrix(nrow = 0, ncol = length(circ_data$Stage)),show_row_names = FALSE,cluster_rows = F,cluster_columns = FALSE, top_annotation = ha)
pdf("heatmap.pdf",width = 7, height = 7)
draw(ht, annotation_legend_side = "bottom")
dev.off()
```

#Overview plot
```{r}
setwd("~/Downloads") 
clinstage <- read.csv("OP-16933_ HNSCC OP.csv")
clinstage_df <- as.data.frame(clinstage)

# Creating the basic swimmer plot
oplot <- swimmer_plot(df=clinstage_df,
                      id='PatientName',
                      end='fu.diff.months',
                      fill='gray',
                      width=.01)

# Adding themes and scales
oplot <- oplot + theme(panel.border = element_blank())
oplot <- oplot + scale_y_continuous(breaks = seq(0, 48, by = 3))
oplot <- oplot + labs(x ="Patients", y="Months from Diagnosis")

# Adding swimmer points
oplot_ev1 <- oplot + swimmer_points(df_points=clinstage_df,
                                    id='PatientName',
                                    time='date.diff.months',
                                    name_shape ='Event_type',
                                    name_col = 'Event',
                                    size=3.5,fill='black')
# Optionally uncomment and use col='darkgreen' if needed

# Adding shape manual scale
oplot_ev1.1 <- oplot_ev1 + ggplot2::scale_shape_manual(name="Event_type",
                                                       values=c(1,16,6,18,18,4),
                                                       breaks=c('ctDNA_neg','ctDNA_pos', 'Imaging','Surgery','Biopsy', 'Death'))

# Display the plot
oplot_ev1.1
                                    oplot_ev2 <- oplot_ev1.1 + swimmer_lines(df_lines=clinstage_df,
                                                                             id='PatientName',
                                                                             start='Tx_start.months',
                                                                             end='Tx_end.months',
                                                                             name_col='Tx_type',
                                                                             size=3.5,
                                                                             name_alpha = 1.0)
                                    oplot_ev2 <- oplot_ev2 + guides(linetype = guide_legend(override.aes = list(size = 5, color = "black")))
                                    oplot_ev2
                                    oplot_ev2.2 <- oplot_ev2 + ggplot2::scale_color_manual(name="Event",values=c( "orangered", "khaki", "black", "black", "green", "red", "purple", "orange", "lightblue", "blue"))
                                    oplot_ev2.2
```

#RFS in Complete Cohort (N=50)
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_datadf <- as.data.frame(circ_data)

survfit(Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)~HNSCC.Cohort, data = circ_data)
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
KM_curve <- survfit(surv_object ~ HNSCC.Cohort, data = circ_data,conf.int=0.95,conf.type="log-log") 
ggsurvplot(KM_curve, data = circ_data, pval = FALSE, conf.int = FALSE, risk.table = TRUE, break.time.by=6, palette=c("blue"), title="RFS - Complete Cohort (n=50)", ylab= "Recurrence-Free Survival", xlab="Months from End of Treatment", legend.labs=c("Complete cohort"), legend.title="")
summary(KM_curve, times= c(18, 24, 36))
```

#OS in Complete Cohort (N=50)
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_datadf <- as.data.frame(circ_data)

survfit(Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)~HNSCC.Cohort, data = circ_data)
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
KM_curve <- survfit(surv_object ~ HNSCC.Cohort, data = circ_data,conf.int=0.95,conf.type="log-log") 
ggsurvplot(KM_curve, data = circ_data, pval = FALSE, conf.int = FALSE, risk.table = TRUE, break.time.by=6, palette=c("blue"), title="OS - Complete Cohort (n=50)", ylab= "Recurrence-Free Survival", xlab="Months from Diagnosis", legend.labs=c("Complete cohort"), legend.title="")
summary(KM_curve, times= c(18, 24, 36))
```

#Association of Baseline ctDNA MTM levels with clinicopathological factors
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.Base!="",]
circ_datadf <- as.data.frame(circ_data)

tally(~cStage, data=circ_data, margins = TRUE)
circ_data$cStage <- factor(circ_data$cStage, levels = c("III","IV"), labels = c("III (n=16)","IV (n=27)"))
boxplot(ctDNA.Base.MTM~cStage, data=circ_data, main="ctDNA pre-treatment MTM - Stage", xlab="Stage", ylab="MTM/mL", col="white",border="black")
m1<-wilcox.test(ctDNA.Base.MTM ~ cStage, data=circ_data, na.rm=TRUE, exact=FALSE, conf.int=TRUE)
print(m1)

tally(~cT.Status, data=circ_data, margins = TRUE)
circ_data$cT.Status <- factor(circ_data$cT.Status, levels = c("cT1-T2","cT3-T4"), labels = c("cT1-T2 (n=17)","cT3-T4 (n=26)"))
boxplot(ctDNA.Base.MTM~cT.Status, data=circ_data, main="ctDNA pre-treatment MTM - cT status", xlab="cT status", ylab="MTM/mL", col="white",border="black")
m2<-wilcox.test(ctDNA.Base.MTM ~ cT.Status, data=circ_data, na.rm=TRUE, exact=FALSE, conf.int=TRUE)
print(m2)

tally(~cN.Status, data=circ_data, margins = TRUE)
circ_data$cN.Status <- factor(circ_data$cN.Status, levels = c("cN0","cN1-N3"), labels = c("cN0 (n=8)","cN1-N3 (n=35)"))
boxplot(ctDNA.Base.MTM~cN.Status, data=circ_data, main="ctDNA pre-treatment MTM - cN status", xlab="cN status", ylab="MTM/mL", col="white",border="black")
m3<-wilcox.test(ctDNA.Base.MTM ~ cN.Status, data=circ_data, na.rm=TRUE, exact=FALSE, conf.int=TRUE)
print(m3)

tally(~p16, data=circ_data, margins = TRUE)
circ_data$p16 <- factor(circ_data$p16, levels = c("Negative","Positive"), labels = c("p16 neg (n=26)","p16 pos (n=17)"))
boxplot(ctDNA.Base.MTM~p16, data=circ_data, main="ctDNA pre-treatment MTM - p16 status", xlab="p16 status", ylab="MTM/mL", col="white",border="black")
m4<-wilcox.test(ctDNA.Base.MTM ~ p16, data=circ_data, na.rm=TRUE, exact=FALSE, conf.int=TRUE)
print(m4)

tally(~Location, data=circ_data, margins = TRUE)
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral","Larynx"), labels = c("Oropharynx/Oral (n=37)","Larynx (n=6)"))
boxplot(ctDNA.Base.MTM~Location, data=circ_data, main="ctDNA pre-treatment MTM - Tumor Location", xlab="Tumor Location", ylab="MTM/mL", col="white",border="black")
m4<-wilcox.test(ctDNA.Base.MTM ~ Location, data=circ_data, na.rm=TRUE, exact=FALSE, conf.int=TRUE)
print(m4)
```

#Median MTM/mL levels for ctDNA positive pts post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_data <- circ_data[circ_data$ctDNA.postTx=="POSITIVE",]

median_ctDNA <- median(circ_data$ctDNA.postTx.MTM, na.rm = TRUE)
range_ctDNA <- range(circ_data$ctDNA.postTx.MTM, na.rm = TRUE)
cat("Median MTM/mL post-treatment:", median_ctDNA, "\n")
cat("Range MTM/mL post-treatment:", range_ctDNA[1], "-", range_ctDNA[2], "\n")
```

#Median time from end treatment to radiological recurrence for ctDNA negative pts post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_data <- circ_data[circ_data$ctDNA.postTx=="NEGATIVE",]
circ_data <- circ_data[circ_data$RFS.Event=="TRUE",]

median_RFS <- median(circ_data$RFS.months, na.rm = TRUE)
range_RFS <- range(circ_data$RFS.months, na.rm = TRUE)
cat("Median RFS:", median_RFS, "\n")
cat("Range RFS:", range_RFS[1], "-", range_RFS[2], "\n")
```

#RFS by ctDNA post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

survfit(Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)~ctDNA.postTx, data = circ_data)
event_summary <- circ_data %>%
  group_by(ctDNA.postTx) %>%
  summarise(
    Total = n(),
    Events = sum(RFS.Event),
    Fraction = Events / n(),
    Percentage = (Events / n()) * 100
  )
print(event_summary)
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
KM_curve <- survfit(surv_object ~ ctDNA.postTx, data = circ_data,conf.int=0.95,conf.type="log-log") 
ggsurvplot(KM_curve, data = circ_data, pval = TRUE, conf.int = FALSE, risk.table = TRUE, break.time.by=6, palette=c("blue","red"), title="RFS - ctDNA post-treatment", ylab= "Recurrence-Free Survival", xlab="Months from End of Treatment", legend.labs=c("ctDNA Negative", "ctDNA Positive"), legend.title="")
summary(KM_curve, times= c(0, 12, 24, 36))
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"))
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data) 
ggforest(cox_fit,data = circ_data) 
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

#Fisher test for RFS percentages at 12, 24, and 36 months
dfs_times <- c(12, 24, 36)
p_values <- sapply(dfs_times, function(time) {
  neg_count <- sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$RFS.months >= time & circ_data$RFS.Event == 0)
  pos_count <- sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$RFS.months >= time & circ_data$RFS.Event == 0)
  neg_total <- sum(circ_data$ctDNA.postTx == "NEGATIVE")
  pos_total <- sum(circ_data$ctDNA.postTx == "POSITIVE")
  
  neg_surv <- neg_total - sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$RFS.Event == 1 & circ_data$RFS.months < time)
  pos_surv <- pos_total - sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$RFS.Event == 1 & circ_data$RFS.months < time)
  
  surv_matrix <- matrix(c(neg_surv, pos_surv, neg_total - neg_surv, pos_total - pos_surv), nrow = 2)
  test_result <- fisher.test(surv_matrix)
  return(test_result$p.value)
})
names(p_values) <- paste0("p-value at ", dfs_times, " months")
print(p_values)
```

#RFS by ctDNA post-treatment - Recurrence at year 1
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

survfit(Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)~ctDNA.postTx, data = circ_data)
event_summary <- circ_data %>%
  group_by(ctDNA.postTx) %>%
  summarise(
    Total = n(),
    Events = sum(RFS.Event.1y),
    Fraction = Events / n(),
    Percentage = (Events / n()) * 100
  )
print(event_summary)
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
KM_curve <- survfit(surv_object ~ ctDNA.postTx, data = circ_data,conf.int=0.95,conf.type="log-log") 
ggsurvplot(KM_curve, data = circ_data, pval = FALSE, conf.int = FALSE, risk.table = TRUE, break.time.by=6, palette=c("blue","red"), title="RFS - ctDNA post-treatment", ylab= "Recurrence-Free Survival", xlab="Months from End of Treatment", legend.labs=c("ctDNA Negative", "ctDNA Positive"), legend.title="")
summary(KM_curve, times= c(0, 12, 24, 36))
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"))
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data) 
ggforest(cox_fit,data = circ_data) 
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

#Fisher test for RFS percentages at 12, 24, and 36 months
dfs_times <- c(12, 24, 36)
p_values <- sapply(dfs_times, function(time) {
  neg_count <- sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$RFS.months >= time & circ_data$RFS.Event.1y == 0)
  pos_count <- sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$RFS.months >= time & circ_data$RFS.Event.1y == 0)
  neg_total <- sum(circ_data$ctDNA.postTx == "NEGATIVE")
  pos_total <- sum(circ_data$ctDNA.postTx == "POSITIVE")
  
  neg_surv <- neg_total - sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$RFS.Event.1y == 1 & circ_data$RFS.months < time)
  pos_surv <- pos_total - sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$RFS.Event.1y == 1 & circ_data$RFS.months < time)
  
  surv_matrix <- matrix(c(neg_surv, pos_surv, neg_total - neg_surv, pos_total - pos_surv), nrow = 2)
  test_result <- fisher.test(surv_matrix)
  return(test_result$p.value)
})
names(p_values) <- paste0("p-value at ", dfs_times, " months")
print(p_values)
```

#Barplot for Recurrence % at year 1 by ctDNA post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads")
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]

circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels = c("NEGATIVE", "POSITIVE"), labels = c("Negative", "Positive"))
circ_data$RFS.Event.1y <- factor(circ_data$RFS.Event.1y, levels = c("FALSE", "TRUE"), labels = c("No Recurrence", "Recurrence"))
contingency_table <- table(circ_data$ctDNA.postTx, circ_data$RFS.Event.1y)
chi_square_test <- chisq.test(contingency_table)
print(chi_square_test)
fisher_exact_test <- fisher.test(contingency_table)
print(fisher_exact_test)
print(contingency_table)
table_df <- as.data.frame(contingency_table)
table_df$Total <- ave(table_df$Freq, table_df$Var1, FUN = sum)
table_df$Percentage <- table_df$Freq / table_df$Total
table_df$MiddlePercentage <- table_df$Percentage / 2
ggplot(table_df, aes(x = Var1, y = Percentage, fill = Var2)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = MiddlePercentage, label = Freq), position = "stack", color = "black", vjust = 1.5, size = 7) +
  theme_minimal() +
  labs(title = "MRD status post-treatment", 
       x = "ctDNA", 
       y = "Patients (%)", 
       fill = "Recurrence",
       caption = paste("Chi-squared test p-value: ", format.pval(chi_square_test$p.value))) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("No Recurrence" = "blue", "Recurrence" = "red")) + # define custom colors
  theme(axis.text.x = element_text(angle = 0, hjust = 1.5, size = 14), # increase x-axis text size
        axis.text.y = element_text(size = 14, color = "black"), # increase y-axis text size
        axis.title.x = element_text(size = 14, color = "black"), # increase x-axis label size
        axis.title.y = element_text(size = 14, color = "black"), # increase y-axis label size
        legend.text = element_text(size = 12, color = "black"))  # increase Recurrence label size
```

#OS by ctDNA post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

survfit(Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)~ctDNA.postTx, data = circ_data)
event_summary <- circ_data %>%
  group_by(ctDNA.postTx) %>%
  summarise(
    Total = n(),
    Events = sum(OS.Event),
    Fraction = Events / n(),
    Percentage = (Events / n()) * 100
  )
print(event_summary)
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
KM_curve <- survfit(surv_object ~ ctDNA.postTx, data = circ_data,conf.int=0.95,conf.type="log-log") 
ggsurvplot(KM_curve, data = circ_data, pval = FALSE, conf.int = FALSE, risk.table = TRUE, break.time.by=6, palette=c("blue","red"), title="OS - ctDNA post-treatment", ylab= "Overall Survival", xlab="Months from Diagnosis", legend.labs=c("ctDNA Negative", "ctDNA Positive"), legend.title="")
summary(KM_curve, times= c(0, 24, 36))
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"))
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data) 
ggforest(cox_fit,data = circ_data) 
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

#Fisher test for RFS percentages at 12, 24, and 36 months
dfs_times <- c(12, 24, 36)
p_values <- sapply(dfs_times, function(time) {
  neg_count <- sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$FU.Biopsy.months >= time & circ_data$OS.Event == 0)
  pos_count <- sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$FU.Biopsy.months >= time & circ_data$OS.Event == 0)
  neg_total <- sum(circ_data$ctDNA.postTx == "NEGATIVE")
  pos_total <- sum(circ_data$ctDNA.postTx == "POSITIVE")
  
  neg_surv <- neg_total - sum(circ_data$ctDNA.postTx == "NEGATIVE" & circ_data$OS.Event == 1 & circ_data$FU.Biopsy.months < time)
  pos_surv <- pos_total - sum(circ_data$ctDNA.postTx == "POSITIVE" & circ_data$OS.Event == 1 & circ_data$FU.Biopsy.months < time)
  
  surv_matrix <- matrix(c(neg_surv, pos_surv, neg_total - neg_surv, pos_total - pos_surv), nrow = 2)
  test_result <- fisher.test(surv_matrix)
  return(test_result$p.value)
})
names(p_values) <- paste0("p-value at ", dfs_times, " months")
print(p_values)
```

#Barplot for Death % by ctDNA post-treatment
```{r}
rm(list=ls())
setwd("~/Downloads")
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]

circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels = c("NEGATIVE", "POSITIVE"), labels = c("Negative", "Positive"))
circ_data$OS.Event <- factor(circ_data$OS.Event, levels = c("FALSE", "TRUE"), labels = c("Alive", "Deceased"))
contingency_table <- table(circ_data$ctDNA.postTx, circ_data$OS.Event)
chi_square_test <- chisq.test(contingency_table)
print(chi_square_test)
fisher_exact_test <- fisher.test(contingency_table)
print(fisher_exact_test)
print(contingency_table)
table_df <- as.data.frame(contingency_table)
table_df$Total <- ave(table_df$Freq, table_df$Var1, FUN = sum)
table_df$Percentage <- table_df$Freq / table_df$Total
table_df$MiddlePercentage <- table_df$Percentage / 2
ggplot(table_df, aes(x = Var1, y = Percentage, fill = Var2)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = MiddlePercentage, label = Freq), position = "stack", color = "black", vjust = 1.5, size = 7) +
  theme_minimal() +
  labs(title = "MRD status post-treatment", 
       x = "ctDNA", 
       y = "Patients (%)", 
       fill = "Vital Status",
       caption = paste("Chi-squared test p-value: ", format.pval(chi_square_test$p.value))) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("Alive" = "blue", "Deceased" = "red")) + # define custom colors
  theme(axis.text.x = element_text(angle = 0, hjust = 1.5, size = 14), # increase x-axis text size
        axis.text.y = element_text(size = 14, color = "black"), # increase y-axis text size
        axis.title.x = element_text(size = 14, color = "black"), # increase x-axis label size
        axis.title.y = element_text(size = 14, color = "black"), # increase y-axis label size
        legend.text = element_text(size = 12, color = "black"))  # increase Recurrence label size
```

#Multivariate cox regression for RFS
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive"))
circ_data$Gender <- factor(circ_data$Gender, levels = c("Female", "Male"), labels = c("Female", "Male"))
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx"))
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2"))
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV"))
circ_data$NAC <- factor(circ_data$NAC, levels = c("TRUE", "FALSE"))
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative"))
surv_object <- Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event) 
cox_fit <- coxph(surv_object ~ ctDNA.postTx + Location + cStage + ECOG.score + p16, data=circ_data) 
ggforest(cox_fit, data = circ_data, main = "Multivariate Regression Model for RFS", refLabel = "Reference Group")
test.ph <- cox.zph(cox_fit)
```


#Univariate RFS cox regression for variables included in MVA
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive")) #univariate for ctDNA post-treatment
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx")) #univariate for Primary location
cox_fit <- coxph(surv_object ~ Location, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV")) #univariate for Stage
cox_fit <- coxph(surv_object ~ cStage, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2")) #univariate for ECOG
cox_fit <- coxph(surv_object ~ ECOG.score, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event)
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative")) #univariate for p16
cox_fit <- coxph(surv_object ~ p16, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)
```

#Multivariate cox regression for RFS - Recurrence at year 1
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive"))
circ_data$Gender <- factor(circ_data$Gender, levels = c("Female", "Male"), labels = c("Female", "Male"))
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx"))
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2"))
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV"))
circ_data$NAC <- factor(circ_data$NAC, levels = c("TRUE", "FALSE"))
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative"))
surv_object <- Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y) 
cox_fit <- coxph(surv_object ~ ctDNA.postTx + Location + cStage + ECOG.score + p16, data=circ_data) 
ggforest(cox_fit, data = circ_data, main = "Multivariate Regression Model for RFS", refLabel = "Reference Group")
test.ph <- cox.zph(cox_fit)
```


#Univariate RFS cox regression for variables included in MVA - Recurrence at year 1
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive")) #univariate for ctDNA post-treatment
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx")) #univariate for Primary location
cox_fit <- coxph(surv_object ~ Location, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV")) #univariate for Stage
cox_fit <- coxph(surv_object ~ cStage, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2")) #univariate for ECOG
cox_fit <- coxph(surv_object ~ ECOG.score, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$RFS.months, event = circ_data$RFS.Event.1y)
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative")) #univariate for p16
cox_fit <- coxph(surv_object ~ p16, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)
```

#Multivariate cox regression for OS
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
circ_datadf <- as.data.frame(circ_data)

circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive"))
circ_data$Gender <- factor(circ_data$Gender, levels = c("Female", "Male"), labels = c("Female", "Male"))
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx"))
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2"))
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV"))
circ_data$NAC <- factor(circ_data$NAC, levels = c("TRUE", "FALSE"))
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative"))
surv_object <- Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event) 
cox_fit <- coxph(surv_object ~ ctDNA.postTx + Location + cStage + ECOG.score + p16, data=circ_data) 
ggforest(cox_fit, data = circ_data, main = "Multivariate Regression Model for OS", refLabel = "Reference Group")
test.ph <- cox.zph(cox_fit)
```

#Univariate OS cox regression for variables included in MVA
```{r}
rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
circ_data$ctDNA.postTx <- factor(circ_data$ctDNA.postTx, levels=c("NEGATIVE","POSITIVE"), labels = c("Negative", "Positive")) #univariate for ctDNA post-treatment
cox_fit <- coxph(surv_object ~ ctDNA.postTx, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
circ_data$Location <- factor(circ_data$Location, levels = c("Oropharynx/Oral", "Larynx")) #univariate for Primary location
cox_fit <- coxph(surv_object ~ Location, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
circ_data$cStage <- factor(circ_data$cStage, levels = c("III", "IV")) #univariate for Stage
cox_fit <- coxph(surv_object ~ cStage, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
circ_data$ECOG.score <- factor(circ_data$ECOG.score, levels = c("0", "1"), labels = c("0", "1/2")) #univariate for ECOG
cox_fit <- coxph(surv_object ~ ECOG.score, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)

rm(list=ls())
setwd("~/Downloads") 
circ_data <- read.csv("OP-16933_HNSCC Clinical data.csv")
circ_data <- circ_data[circ_data$ctDNA.available=="TRUE",]
circ_data <- circ_data[circ_data$ctDNA.postTx!="",]
surv_object <-Surv(time = circ_data$FU.Biopsy.months, event = circ_data$OS.Event)
circ_data$p16 <- factor(circ_data$p16, levels = c("Positive", "Negative")) #univariate for p16
cox_fit <- coxph(surv_object ~ p16, data=circ_data)
summary(cox_fit)
cox_fit_summary <- summary(cox_fit)

#Extract values for HR, 95% CI, and p-value
HR <- cox_fit_summary$coefficients[2]
lower_CI <- cox_fit_summary$conf.int[3]
upper_CI <- cox_fit_summary$conf.int[4]
p_value <- cox_fit_summary$coefficients[5]
label_text <- paste0("HR = ", round(HR, 2), " (", round(lower_CI, 2), "-", round(upper_CI, 2), "); p = ", round(p_value, 3))
print(label_text)
```
